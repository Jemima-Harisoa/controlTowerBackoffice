# ğŸš€ GUIDE DE DÃ‰MARRAGE - CONTROL TOWER

## ğŸ“‹ PrÃ©requis

Avant de commencer, assure-toi d'avoir installÃ© :

- **Docker Desktop** (ou Docker Engine + Docker Compose)
- **Maven** (pour build local en dev)
- **Java JDK 11 ou 17**

## ğŸŒ Comprendre les 3 environnements

### 1ï¸âƒ£ DÃ‰VELOPPEMENT LOCAL (`docker-compose.dev.yml`)

**Quand l'utiliser ?**
- Tu codes et veux voir tes changements rapidement
- Tu veux debugger avec des logs dÃ©taillÃ©s
- Tu as besoin d'Adminer pour gÃ©rer la DB

**Comment Ã§a marche ?**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ta machine locale  â”‚
â”‚                     â”‚
â”‚  1. Tu modifies     â”‚
â”‚     le code         â”‚
â”‚                     â”‚
â”‚  2. Tu build avec:  â”‚
â”‚     mvn clean       â”‚
â”‚     package         â”‚
â”‚                     â”‚
â”‚  3. Le WAR est      â”‚
â”‚     gÃ©nÃ©rÃ© dans     â”‚
â”‚     target/         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Volume partagÃ©
           â”‚ (pas de copie, juste un lien)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conteneur Docker   â”‚
â”‚                     â”‚
â”‚  Tomcat lit         â”‚
â”‚  directement ton    â”‚
â”‚  WAR depuis         â”‚
â”‚  target/            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Avantages :**
- âœ… Pas besoin de rebuild l'image Docker Ã  chaque fois
- âœ… Changements visibles aprÃ¨s un simple `mvn package`
- âœ… Logs accessibles dans `dev/logs/`

**Commandes :**
```bash
# PremiÃ¨re fois : crÃ©er le dossier pour les logs
mkdir -p dev/logs

# Builder ton application
mvn clean package

# DÃ©marrer l'environnement
docker-compose -f docker-compose.dev.yml up

# AccÃ¨s :
# - Application : http://localhost:8080
# - Adminer : http://localhost:8081
# - PostgreSQL : localhost:5432
```

---

### 2ï¸âƒ£ STAGING (`docker-compose.staging.yml`)

**Quand l'utiliser ?**
- Avant de merger sur `main`
- Pour tester dans un environnement proche de la prod
- Pour vÃ©rifier que le build complet fonctionne

**Comment Ã§a marche ?**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Build Docker       â”‚
â”‚                     â”‚
â”‚  1. Maven build     â”‚
â”‚     dans conteneur  â”‚
â”‚                     â”‚
â”‚  2. WAR copiÃ©       â”‚
â”‚     dans l'image    â”‚
â”‚                     â”‚
â”‚  3. Image complÃ¨te  â”‚
â”‚     crÃ©Ã©e           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Image autonome
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conteneur Docker   â”‚
â”‚                     â”‚
â”‚  Tout est dÃ©jÃ       â”‚
â”‚  dans l'image       â”‚
â”‚  (autonome)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Avantages :**
- âœ… Teste le processus de build complet
- âœ… Image autonome (pas de dÃ©pendance avec l'hÃ´te)
- âœ… Configuration proche de la prod

**Commandes :**
```bash
# CrÃ©er le fichier .env.staging avec les bons paramÃ¨tres
cp .env .env.staging

# Modifier .env.staging :
# - APP_ENV=staging
# - APP_PORT=8082
# - POSTGRES_PORT=5433

# Builder et dÃ©marrer
docker-compose -f docker-compose.staging.yml --env-file .env.staging up --build

# AccÃ¨s :
# - Application : http://localhost:8082
# - PostgreSQL : localhost:5433
```

---

### 3ï¸âƒ£ PRODUCTION (Render)

**Quand l'utiliser ?**
- DÃ©ploiement sur `main`
- Environnement accessible aux utilisateurs

**Comment Ã§a marche ?**
- Render utilise ton `Dockerfile` principal
- Build automatique Ã  chaque push sur `main`
- Pas de volumes, tout est dans l'image

---

## ğŸ”§ Workflow de dÃ©veloppement recommandÃ©

### ScÃ©nario 1 : DÃ©veloppement quotidien

```bash
# 1. DÃ©marrer l'environnement dev
docker-compose -f docker-compose.dev.yml up -d

# 2. DÃ©velopper ton code
# (Ã©diter les fichiers dans src/)

# 3. Rebuild aprÃ¨s chaque modification
mvn clean package

# 4. RedÃ©marrer juste l'app (pas la DB)
docker-compose -f docker-compose.dev.yml restart app

# 5. Voir les logs
docker-compose -f docker-compose.dev.yml logs -f app
```

### ScÃ©nario 2 : PrÃ©parer une release

```bash
# 1. S'assurer que dev fonctionne
mvn clean package
docker-compose -f docker-compose.dev.yml up

# 2. Tester en staging
docker-compose -f docker-compose.staging.yml --env-file .env.staging up --build

# 3. Si OK â†’ commit et push sur staging/sprint/X

# 4. Merger vers main aprÃ¨s validation
```

---

## ğŸ› RÃ©soudre les problÃ¨mes courants

### ProblÃ¨me : "Cannot access page" (page non accessible)

**Causes possibles :**

1. **Le WAR n'existe pas**
   ```bash
   # VÃ©rifier que le WAR est gÃ©nÃ©rÃ©
   ls -lh target/ControlTowerBackoffice.war
   
   # Si absent, builder :
   mvn clean package
   ```

2. **Tomcat n'a pas dÃ©marrÃ©**
   ```bash
   # Voir les logs
   docker-compose -f docker-compose.dev.yml logs app
   
   # Chercher des erreurs dans les logs
   ```

3. **Port dÃ©jÃ  utilisÃ©**
   ```bash
   # VÃ©rifier les ports utilisÃ©s
   docker ps
   
   # Changer le port dans .env :
   APP_PORT=8085
   ```

### ProblÃ¨me : "Permission denied" sur le WAR

**Solution pour dev :**
```bash
# Donner les permissions
chmod 644 target/ControlTowerBackoffice.war

# RedÃ©marrer
docker-compose -f docker-compose.dev.yml restart app
```

### ProblÃ¨me : Changements non visibles

```bash
# 1. Rebuild le WAR
mvn clean package

# 2. RedÃ©marrer l'application
docker-compose -f docker-compose.dev.yml restart app

# 3. Vider le cache du navigateur (Ctrl+Shift+R)
```

---

## ğŸ“Š Tableau rÃ©capitulatif

| CritÃ¨re      | DEV                      | STAGING                      | PROD             |
|--------------|--------------------------|------------------------------|------------------|
| **Fichier**  | `docker-compose.dev.yml` | `docker-compose.staging.yml` | `Dockerfile`     |
| **Build**    | Local (Maven)            | Dans Docker                  | Dans Docker      |
| **WAR**      | Volume partagÃ©           | CopiÃ© dans image             | CopiÃ© dans image |
| **Port app** | 8080                     | 8082                         | 8080             |
| **Port DB**  | 5432                     | 5433                         | (Render)         |
| **Adminer**  | âœ… Oui                   | âŒ Non                      | âŒ Non           |
| **Logs**     | DEBUG                    | INFO                         | WARN             |
| **Hot reload** | âœ… Oui | âŒ Non | âŒ Non |


## ğŸ’¡ Bonnes pratiques

### âœ… Ã€ FAIRE
- Toujours builder avec `mvn clean package` avant de dÃ©marrer
- Utiliser `.env.dev` et `.env.staging` sÃ©parÃ©s
- VÃ©rifier les logs avec `docker-compose logs -f app`
- ArrÃªter proprement avec `docker-compose down`

### âŒ Ã€ NE PAS FAIRE
- Ne pas commiter le fichier `.env`
- Ne pas utiliser les mÃªmes ports pour dev et staging
- Ne pas oublier de rebuild aprÃ¨s modification du code
- Ne pas mÃ©langer les configurations d'environnement

---
